---
title: Вопросы проверки подлинности
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 01/25/2021
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "7748"
- "9004339"
ms.openlocfilehash: 2f413e863e6aa23548e425de5901f8158e1d48ab
ms.sourcegitcommit: ba3118b7ad5e02756d0e5c2113245090f54370af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "49976862"
---
# <a name="authentication-issues"></a>Вопросы проверки подлинности

**Ищете информацию о кодах ошибок AADSTS, которые возвращаются из службы маркеров безопасности (STS) Azure Active Directory (Azure AD)?** См. статью [Коды ошибок проверки подлинности и авторизации в Azure AD](https://docs.microsoft.com/azure/active-directory/develop/reference-aadsts-error-codes), чтобы найти описания ошибок AADSTS, исправления и некоторые предлагаемые временные решения.

Ошибки авторизации могут возникать в результате ряда различных неполадок, большая часть которых приводит к возникновению ошибки "401" или "403". Например, ошибки авторизации могут возникнуть в результате следующих неполадок:

- Некорректные [потоки получения маркеров доступа](https://docs.microsoft.com/azure/active-directory/develop/authentication-vs-authorization) 
- Неправильно настроенные [области разрешений](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent) 
- Отсутствие [согласия](https://docs.microsoft.com/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant#understanding-user-and-admin-consent)

Чтобы устранить распространенные ошибки авторизации, попробуйте выполнить указанные ниже действия, описанные для ошибки, которая максимально похожа на вашу. Для полученной ошибки может применяться несколько действий.

**Ошибка "401 — недостаточно прав": является ли маркер допустимым?**

Убедитесь, что приложение выводит допустимый маркер доступа к Microsoft Graph в рамках запроса. Эта ошибка часто означает, что маркер доступа отсутствует в заголовке HTTP-запроса на проверку подлинности, что он недопустим или срок его действия истек. Мы настоятельно рекомендуем использовать Библиотеку проверки подлинности Майкрософт (MSAL) для получения маркеров доступа. Кроме того, эта ошибка может возникать при попытке использовать маркер делегированного доступа, предоставленный личной учетной записи Майкрософт, для доступа к API, который поддерживает только рабочие или учебные учетные записи (учетные записи организации).

**Ошибка "403 — запрещено": выбран ли соответствующий набор разрешений?**

Убедитесь, что вы запросили правильный набор разрешений на основе API Microsoft Graph, который вызывает приложение. Разрешения с минимальными привилегиями, которые мы рекомендуем, рассматриваются во всех статьях, посвященных методу API Microsoft Graph. Кроме того, эти разрешения должны быть предоставлены приложению пользователем или администратором. Для предоставления разрешений обычно используется страница согласия или колонка "Регистрация приложений" на портале Azure. В колонке для приложения **Параметры** выберите **Необходимые разрешения** > **Предоставить разрешения**. Дополнительные сведения см. в следующих статьях.

- [Разрешения Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference) 
- [Общие сведения о разрешениях Azure AD и согласии](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent)

**Ошибка "403 — запрещено": получило ли приложение маркер для соответствия выбранным разрешениям?**

Убедитесь, что тип запрошенных или предоставленных разрешений совпадает с типом маркера доступа, который получает приложение. Возможно, вы запрашиваете и предоставляете разрешения для приложения, но используете маркеры потоков делегированного интерактивного кода вместо маркеров потоков учетных данных клиента, или запрашиваете и предоставляете делегированные разрешения, но используете маркеры потоков учетных данных клиента вместо маркеров потоков делегированного кода.

Дополнительные сведения о получении маркеров см. в статьях:

- [Получение доступа от имени пользователей и делегированные разрешения](https://docs.microsoft.com/graph/auth-v2-user) 
- [Azure AD версии 2.0 — поток кода авторизации OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) 
- [Получение доступа без пользователя (служба управляющей программы) и разрешения приложения](https://docs.microsoft.com/graph/auth-v2-service) 
- [Azure AD версии 2.0 — поток учетных данных клиента OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**Ошибка "403 — запрещено": сброс пароля**

В настоящее время нет разрешений для служб программы, управляющей разрешениями приложения, которые позволяют сбросить пароли пользователей. Эти API поддерживаются только с помощью потоков интерактивного делегированного кода для администратора, выполнившего вход. Дополнительные сведения см. в статье [Разрешения Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference).

**Ошибка "403 — запрещено": есть ли доступ у пользователя, и имеет ли он лицензию?**

Microsoft Graph определяет, разрешено ли выполнение запроса для потоков делегированного кода на основании разрешений, предоставленных приложению, и разрешений, имеющихся у пользователя, выполнившего вход. Как правило, эта ошибка указывает на то, что пользователь не обладает достаточными правами для выполнения запроса **или** что у пользователя нет лицензии на доступ к данным. Только пользователи с необходимыми разрешениями или лицензиями могут успешно выполнить запрос.

**Ошибка "403 — запрещено": выбран ли правильный API ресурсов?**

Службы API, такие как Microsoft Graph, проверяют, чтобы утверждение *aud* (audience) в полученном маркере доступа соответствовало ожидаемому значению, в противном случае возникает ошибка "403 — запрещено". Чаще всего эта ошибка возникает при попытке использовать маркер, полученный для API Azure AD Graph, API Outlook или API SharePoint/OneDrive, для вызова Microsoft Graph (или наоборот). Убедитесь, что ресурс (или область), для которого приложение получает маркер, соответствует API, который вызывает приложение.

**Ошибка "400 — ошибочный запрос" или "403 — запрещено": выполняет ли пользователь требования политики условного доступа своей организации?**

На основании политик условного доступа (CA) организации у пользователя, получающего доступ к ресурсам Microsoft Graph через ваше приложение, могут быть запрошены дополнительные сведения, отсутствующие в маркере доступа, который изначально был получен вашим приложением. В этом случае приложение получает сообщение об ошибке **400 с *interaction_required*** при получении маркера доступа или сообщение об ошибке **403 с *insufficient_claims*** при вызове Microsoft Graph. В обоих случаях сообщение об ошибке содержит дополнительные сведения, которые могут быть представлены в авторизированную конечную точку, чтобы запросить у пользователя дополнительную информацию (например, многофакторная проверка подлинности или регистрация устройства).

Дополнительные сведения, относящиеся к условному доступу, см. в статье:

- [Обработка запросов условного доступа с помощью MSAL](https://docs.microsoft.com/azure/active-directory/develop/msal-error-handling-dotnet#conditional-access-and-claims-challenges) 
- [Руководство для разработчиков по условному доступу в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/v2-conditional-access-dev-guide)

**_Окончание поддержки Библиотеки проверки подлинности Azure Active Directory (ADAL) и API Azure AD Graph (AAD Graph_*)_

- С 30 июня 2020 г. мы больше не будем добавлять новые возможности в Библиотеку проверки подлинности Azure Active Directory (ADAL) и API Azure AD Graph (AAD Graph). Мы продолжим предоставлять техническую поддержку и обновления для системы безопасности, но больше не будем предоставлять обновления компонентов.
- С 30 июня 2022 г. мы завершаем поддержку ADAL и AAD Graph и больше не будем предоставлять техническую поддержку и обновления для системы безопасности.
    - Приложения, использующие ADAL в существующих версиях ОС, будут по-прежнему работать после этой даты, но им не будет предоставляться техническая поддержка и обновления для системы безопасности.
    - Приложения, использующие AAD Graph после этой даты, больше не будут получать ответы от конечной точки AAD Graph.

_ *Миграция приложений, использующих ADAL**

Мы рекомендуем выполнить обновление до [Библиотеки проверки подлинности Microsoft (MSAL)](https://docs.microsoft.com/azure/active-directory/develop/v2-overview), включающей новые возможности и обновления для системы безопасности. Эта рекомендация дается в контексте запуска корпорацией Майкрософт процесса миграции ее приложений в MSAL к дате окончания поддержки. Цель миграции приложений Майкрософт в MSAL заключается в обеспечении применения текущих улучшений системы безопасности и компонентов MSAL в приложениях.

- [Ознакомьтесь с вопросами и ответами по ADAL](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- [Сведения о миграции приложений для каждой платформы](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- Если вам нужна помощь, чтобы понять, которые из ваших приложений используют ADAL, рекомендуем просмотреть исходный код всех приложений и, если возможно, связаться с независимыми поставщиками программного обеспечения (ISV) или поставщиками приложений. Кроме того, служба поддержки корпорации Майкрософт может предоставить вам список всех приложений сторонних разработчиков, использующих ADAL, в вашем клиенте.

**Миграция приложений, использующих AAD Graph**

Следуйте нашему руководству, чтобы [перенести приложения, использующие AAD Graph, в Microsoft Graph](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0&preserve-view=true).

- [Контрольный список миграции содержит стартовую точку](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist). 
- На портале регистрации приложений Azure показано, какие приложения используют AAD Graph. Рекомендуем просмотреть исходный код всех приложений и, если возможно, связаться с независимыми поставщиками программного обеспечения (ISV) или поставщиками приложений. Кроме того, служба поддержки корпорации Майкрософт может предоставить вам сведения об использовании всех AAD Graph в вашем клиенте.

 










